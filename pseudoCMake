project(template-project)

set(STLIB_DIR ../ST-LIB)
add_subdirectory(${STLIB_DIR})

add_sources(
    Core/Src/*,
    Core/Startup/*
)

link_libraries(${STLIB_DIR}/build/libst-lib.a)

compile_definitions(
    USE_HAL_DRIVER,
    STM32H723XX,
    DATA_IN_D2_SRAM
    )

include_directories(
    Core/Inc,
    Drivers/*,
    LWIP/*,
    Middlewares/*,
)

compile_options(
    mcpu=cortex-m7,
    mfpu=fpv5-d16,
    mfloat-abi=hard,
    mthumb,
    O0,
    ffunction-sections,
    fdata-sections,
    fno-exceptions,
    $<$<COMPILE_LANGUAGE:CXX:fno-rtti>,
    $<$<COMPILE_LANGUAGE:CXX:fno-use-cxa-atexit>,
    Wall
    --specs=nosys.specs
)

link_options( 
    T${CMAKE_SOURCE_DIR}/STM32H723ZGTX_FLASH.ld
    mcpu=cortex-m7
    mthumb
    mfpu=fpv5-d16
    mfloat-abi=hard
    specs=nosys.specs
    lc
    lm
    lnosys
    Wl,-Map=${PROJECT_NAME}.map,--cref
    Wl,--gc-sections
)

post_build_command(arm-none-eabi-size ${EXECUTABLE})
post_build_command(arm-none-eabi-objcopy -O ihex ${EXECUTABLE} ${PROJECT_NAME}.hex)
post_build_command(arm-none-eabi-objcopy -O binary ${EXECUTABLE} ${PROJECT_NAME}.bin)
